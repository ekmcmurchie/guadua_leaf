---
title: "Guadua Leaf Micromorphology Graphics"
author: "Elizabeth McMurchie and Devin Molnau"
date: "2025-03-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load appropriate libraries, installing if needed
```{r}
library(tidyverse) #includes ggplot2 needed for graphics
library(ade4) #needed for PcoA
library(vegan) #needed for PCoA
library(ggcorrplot) #for correlation tables
```

## Read in data as dataframe
```{r}
guadualeaf <- read_csv("../data/tidy/guadualeaf.csv", col_names = TRUE, na = "x")
```

## Drop columns with NA and no variation and create dataframe with columns as factors
```{r}
guadualeaf <- guadualeaf %>%
  select(-c(ad_stomata_freq, ad_papillae_overarch, ad_triangular_sub_cells,
            ad_dome_sub_cells, ad_parallel_sub_cells, ab_ridged_saddle_intercostal,
            ad_ridged_saddle_intercostal)) # remove columns with NA or no variation

df_guadualeaf = data.frame(guadualeaf, stringsAsFactors = TRUE) # create dataframe

df_guadualeaf <- data.frame(lapply(df_guadualeaf,as.factor)) # set columns as factors

```

### Correlation
Viewing the correlation dataframe is useful for understanding which traits are correlated.The two-sided correlation plot was used as Appendix C Figure 1 (Figure C.1) in the manuscript. The one-sided correlation plot was not used in the manuscript; this image was used to more easily visualize each correlation.
```{r}
guadua_y_binary <- df_guadualeaf[,9:ncol(df_guadualeaf)] # reads in the binary data only 
guadua_y_binary_df <- data.frame(lapply(guadua_y_binary,function(x) as.numeric(levels(x))[x]))
correlation_y_guadua <- data.frame(cor(guadua_y_binary_df)) #calculated the correlation of the Y values

#view(correlation_y_guadua) #viewing basic correlation table

#ggcorrplot alows us to view correlation table with colors indicating correlation values

#Two-sided correlation plot

ggcorrplot(correlation_y_guadua, hc.order = TRUE, lab = TRUE)

corrs <- ggcorrplot(correlation_y_guadua, hc.order = TRUE, lab = TRUE, ggtheme = theme_bw())

ggsave("leafcorrplot.pdf", plot = corrs, width = 26, height = 22, units = "in", dpi = 600)


ggsave("leafcorrplot.tiff", plot = corrs, width = 26, height = 22, units = "in", dpi = 600)

#One-sided correlation plot

corrs2 <- ggcorrplot(correlation_y_guadua, hc.order = TRUE, lab = TRUE, type = "upper", ggtheme = theme_bw())

ggsave("leafcorrplot2.tiff", plot = corrs2, width = 26, height = 22, units = "in", dpi = 600)

```

### PCoA 
The distance matrix for the binary data is obtained using simple matching coefficient. The PCoA from the distance matrix can be used to visualize the pairwise distances between the micromorphology of individual *Guadua* specimens.
```{r}
guadua_y_dist <- dist.binary(guadua_y_binary_df, method = 2, diag = FALSE, upper = FALSE) # convert to distances using simple matching coefficient
guadua_y_dist_matrix <- as.matrix(guadua_y_dist) # create matrix using simple matching distances
PCoA <- cmdscale(guadua_y_dist_matrix, eig = TRUE, x.ret = TRUE, list. = TRUE) #from vegan - run PcoA
```

# PCoA grouped by habit (3 categories)
For this PCoA, individual specimens are colored by the habit typical of their species. Three habitat groups were used: big and erect, leaning/climbing, and small arching. This PCoA is used as Figure 7 in the manuscript.
```{r}
group.colors <- c("big_erect" = "#7b3294", "leaning_climbing" = "#1b7837",
                  "small_arching" = "#f1a340") #to set colors

nice_df <- PCoA$points %>% 
  data.frame
nice_df$habit <- df_guadualeaf$habit
habitatpcoa <- nice_df %>% 
  ggplot(aes(X1, X2)) +
  geom_point(aes(color = habit, shape = habit), size = 2) +
  scale_color_manual(name = "Habit", breaks = c("big_erect", "leaning_climbing", "small_arching"),
                     labels = c("Tall and erect", "Leaning/climbing", "Small arching"),
                     values = group.colors) + 
  scale_shape_manual(name = "Habit", breaks = c("big_erect", "leaning_climbing", "small_arching"),
                     labels = c("Tall and erect", "Leaning/climbing", "Small arching"),
                     values = c(15, 17, 19)) + 
  theme_minimal() +
  theme(panel.border = element_rect(size = 2, color = "black", fill = NA)
  ) + 
  theme(plot.background = element_rect(fill = 'white', color = 'white')) +
  labs(
    color = "Habit", 
    x = "PCoA1",
    y = "PCoA2"
  )

plot(habitatpcoa)

ggsave("leafhabits3.pdf", plot = habitatpcoa, width = 6, height = 4, units = "in", dpi = 600)

ggsave("leafhabits3.tiff", plot = habitatpcoa, width = 6, height = 4, units = "in", dpi = 600)
```

# PCoA grouped by species
For this PCoA, individual specimens are colored by species. This PCoA is used as Figure 8 in the manuscript.

```{r}

group.colors <- c("g_aculeata" = "#7b3294", "g_amplexifolia" = "#1b7837",
                  "g_angustifolia" = "#f1a340", "g_calderoniana" = "#00441b","g_chacoensis" = "#5aae61",
                  "g_chaparensis" = "#7f3b08", "g_ciliata" = "#40004b", "g_glomerata" = "#9970ab", 
                  "g_guzmanii" = "#253494", "g_incana" = "#c7e9b4", "g_latifolia" = "#7fcdbb", 
                  "g_longifolia" = "#bd0026", "g_maclurei" = "#fed976", "g_macrospiculata" = "#bfd3e6", 
                  "g_macrostachya" = "#fd8d3c", "g_paniculata" = "#e7298a", 
                  "g_paraguayana" = "#8c96c6", "g_refracta" = "#081d58", "g_sarcocarpa" = "#810f7c", 
                  "g_superba" = "#41b6c4", "g_tagoara" = "#800026", "g_trinii" = "#dd3497",
                  "g_tuxtlensis" = "#fa9fb5", "g_uncinata" = "#1d91c0", "g_velutina" = "#016c59", 
                  "g_venezuelae" = "#feb24c", "g_virgata" = "#e31a1c", "g_weberbaueri" = "#78c679", 
                  "g_aff_glomerata" = "#993404", "g_aff_trinii" = "#41ab5d",
                  "g_aff_virgata" = "#fc4e2a", "g_aff_weberbaueri" = "#d4b9da") #to set colors

nice_df <- PCoA$points %>% 
  data.frame
nice_df$species <- df_guadualeaf$species
speciespcoa <- nice_df %>% 
  ggplot(aes(X1, X2)) +
  geom_point(aes(color = species, shape = species), size = 2) +
  scale_color_manual(name = "Species", 
                     breaks = c("g_aculeata", "g_amplexifolia","g_angustifolia",
                                "g_calderoniana","g_chacoensis","g_chaparensis",
                                "g_ciliata", "g_glomerata", "g_guzmanii", "g_incana",
                                "g_latifolia", "g_longifolia", "g_maclurei", "g_macrospiculata",
                                "g_macrostachya", "g_paniculata", "g_paraguayana",
                                "g_refracta", "g_sarcocarpa", "g_superba", "g_tagoara", "g_trinii",
                                "g_tuxtlensis", "g_uncinata", "g_velutina", "g_venezuelae",
                                "g_virgata", "g_weberbaueri", "g_aff_glomerata",
                                "g_aff_trinii", "g_aff_virgata", "g_aff_weberbaueri"),
                                labels = c("G. aculeata", "G. amplexifolia", "G. angustifolia",
                                           "G. calderoniana", "G. chacoensis", "G. chaparensis",
                                           "G. ciliata","G. glomerata", "G. guzmanii", "G. incana",
                                           "G. latifolia", "G. longifolia", "G. macclurei",
                                           "G. macrospiculata", "G. macrostachya","G. paniculata",
                                           "G. paraguayana", "G. refracta","G. sarcocarpa", "G. superba",
                                           "G. tagoara", "G. trinii", "G. tuxtlensis", "G. uncinata",
                                           "G. velutina","G. venezuelae", "G. virgata", "G. weberbaueri",
                                           "G. aff. glomerata", "G. aff. trinii",
                                           "G. aff. virgata", "G. aff. weberbaueri"),
                     values = group.colors) + 
    scale_shape_manual(name = "Species", 
                     breaks = c("g_aculeata", "g_amplexifolia","g_angustifolia",
                                "g_calderoniana","g_chacoensis","g_chaparensis",
                                "g_ciliata", "g_glomerata", "g_guzmanii", "g_incana",
                                "g_latifolia", "g_longifolia", "g_maclurei", "g_macrospiculata",
                                "g_macrostachya", "g_paniculata", "g_paraguayana",
                                "g_refracta", "g_sarcocarpa", "g_superba", "g_tagoara", "g_trinii",
                                "g_tuxtlensis", "g_uncinata", "g_velutina", "g_venezuelae",
                                "g_virgata", "g_weberbaueri", "g_aff_glomerata",
                                "g_aff_trinii", "g_aff_virgata", "g_aff_weberbaueri"),
                                labels = c("G. aculeata", "G. amplexifolia", "G. angustifolia",
                                           "G. calderoniana", "G. chacoensis", "G. chaparensis",
                                           "G. ciliata","G. glomerata", "G. guzmanii", "G. incana",
                                           "G. latifolia", "G. longifolia", "G. macclurei",
                                           "G. macrospiculata", "G. macrostachya","G. paniculata",
                                           "G. paraguayana", "G. refracta","G. sarcocarpa", "G. superba",
                                           "G. tagoara", "G. trinii", "G. tuxtlensis", "G. uncinata",
                                           "G. velutina","G. venezuelae", "G. virgata", "G. weberbaueri",
                                           "G. aff. glomerata", "G. aff. trinii",
                                           "G. aff. virgata", "G. aff. weberbaueri"),
                     values = c(15, 17, 19, 18, 3, 8, 4, 7, 9, 15, 3, 25, 23, 24, 21, 22, 18, 7, 9, 8, 
                                15, 17, 19, 18, 15, 17, 8, 23, 24, 21, 3, 8)) + 
  theme_minimal() +
  theme(
    panel.border = element_rect(size = 2, color = "black", fill = NA)
  ) + 
    theme(plot.background = element_rect(fill = 'white', color = 'white')) +
  labs(
    color = "Species", 
    x = "PCoA1",
    y = "PCoA2"
  )

plot(speciespcoa)

ggsave("leafspecies.pdf", plot = speciespcoa, width = 10, height = 6, units = "in", dpi = 600)

ggsave("leafspecies.tiff", plot = speciespcoa, width = 10, height = 6, units = "in", dpi = 600)

```


# PCoA grouped by habitat (3 categories)
For this PCoA, individual specimens are colored by the habitat typical of their species. Three habitat groups were used: Forest, river, and savanna. This PCoA is used as Figure 6 in the manuscript.
```{r}
group.colors3 <- c("forest" = "#7b3294", "river" = "#1b7837",
                   "savanna" = "#f1a340")

nice_df <- PCoA$points %>% 
  data.frame
nice_df$habitat <- df_guadualeaf$habitat
habitatspcoa <- nice_df %>% 
  ggplot(aes(X1, X2)) +
  geom_point(aes(color = habitat, shape = habitat), size = 2) +
  scale_color_manual(name = "Habitat", breaks = c("forest", "river", "savanna"),
                     labels = c("Forest", "River", "Savanna"),
                     values = group.colors3) + 
  scale_shape_manual(name = "Habitat", breaks = c("forest", "river", "savanna"),
                     labels = c("Forest", "River", "Savanna"),
                     values = c(15, 17, 19)) +
  theme_minimal() +
  theme(
    panel.border = element_rect(size = 2, color = "black", fill = NA)
  ) + 
      theme(plot.background = element_rect(fill = 'white', color = 'white')) +
  labs(
    color = "Habitat", 
    x = "PCoA1",
    y = "PCoA2"
  )

ggsave("leafhabitat3.pdf", plot = habitatspcoa, width = 6, height = 4, units = "in", dpi = 600)

ggsave("leafhabitat3.tiff", plot = habitatspcoa, width = 6, height = 4, units = "in", dpi = 600)

```


# PCoA grouped by region
For this PCoA, individual specimens are colored by general region in which the specimen was collected. Four general regions were used: Andes, Central America, and Eastern South America. Assignment of region to each specimen can be seen in 'specimen_data.xls' in the 'documents' folder. This PCoA was not used in the manuscript. We did not expect to see any grouping based on region, as each region contains a variety of species of different habits and habitats.
```{r}
group.colors5 <- c("andes" = "#7b3294", "central_america" = "#1b7837",
                   "eastern_south_america" = "#af8dc3", "mexico" = "#f1a340")

nice_df <- PCoA$points %>% 
  data.frame
nice_df$region <- df_guadualeaf$region
regionpcoa <- nice_df %>% 
  ggplot(aes(X1, X2)) +
  geom_point(aes(color = region, shape = region), size = 2) +
  scale_color_manual(name = "Region", breaks = c("andes", "central_america",
                                                 "eastern_south_america", "mexico"),
                     labels = c("Andes", "Central America", "Eastern South America", "Mexico"),
                     values = group.colors5) + 
  scale_shape_manual(name = "Region", breaks = c("andes", "central_america",
                                                 "eastern_south_america", "mexico"),
                     labels = c("Andes", "Central America", "Eastern South America", "Mexico"),
                     values = c(15, 17, 19, 18)) + 
  theme_minimal() +
  theme(
    panel.border = element_rect(size = 2, color = "black", fill = NA)
  ) +
    theme(plot.background = element_rect(fill = 'white', color = 'white')) +
  labs(
    color = "Region", 
    x = "PCoA1",
    y = "PCoA2"
  )

plot(regionpcoa)

ggsave("leafregion.pdf", plot = regionpcoa, width = 6, height = 4, units = "in", dpi = 600)
```

### Scree plot from the PCoA 
From this we can obtain eigenvalues and then plot them to show the percent variation explained along each PCoA axis. As seen in the plot below, PCoA axis 1 is responsible for the majority of variation in the PCoA, followed by a steep drop in variation. By the 25th axis, variation is minimal and by the 50th, arguably negligible. Elbow is at approximately the sixth principal coordinate axis.This image was used as Figure C.3 - Appendix C Figure 3 in the manuscript.
```{r}
eig_df <- data.frame( x_values = c(1:length(PCoA$eig)) , eig_value = c(PCoA$eig))
scree <- ggplot(data = eig_df, aes(x = x_values, y = eig_value)) +
  geom_line() +
  geom_point() + 
  theme_minimal() +
  theme(
    panel.border = element_rect(size = 2, color = "black", fill = NA)
  ) + 
  theme(plot.background = element_rect(fill = 'white', color = 'white')) +
  labs(
    x = "Coordinate number",
    y = "Eigenvalue"
  )

ggsave("leafscree.pdf", plot = scree, width = 6, height = 4, units = "in", dpi = 1000)

ggsave("leafscree.tiff", plot = scree, width = 6, height = 4, units = "in", dpi = 1500)
```

# Pie Charts
The following pie charts show percentage of specimens belonging to different habitat groups for which a certain micromorphological feature was present or absent on foliage leaves. These pie charts were used as components of Figures 2 and 3 in the manuscript. 

## Pie charts - specimens from river species

##Filtering dataframe for river species only
```{r}
#Filter dataframe of foliar micromorphology to include only river species
guadualeaf_river <- df_guadualeaf %>%
  filter(habitat == "river")
```

##River: Pie chart of simple papillae on long cells of stomatal regions on abaxial leaf surface presence/absence
```{r}
#Group by simple papillae on long cells of stomatal regions on abaxial surface only and obtain percentage present/absent
guadualeaf_river_per_ab_pap_sto <- guadualeaf_river %>% 
  group_by(ab_simple_papillae_long_cells_stomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_per_ab_pap_sto)

#Create labeled pie chart of percentage of river specimens with papillae on long cells of stomatal regions on abaxial surface
ggplot(guadualeaf_river_per_ab_pap_sto, aes(x = "", y = perc, fill = ab_simple_papillae_long_cells_stomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells
of stomatal region")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_abaxial_simple_papillae_stomatal <- ggplot(guadualeaf_river_per_ab_pap_sto, aes(x = "", y = perc, fill = ab_simple_papillae_long_cells_stomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells
of stomatal region of abaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_abaxial_simple_papillae_stomatal.tiff", plot = river_pie_abaxial_simple_papillae_stomatal, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of simple papillae on long cells of interstomatal regions of abaxial leaf surface presence/absence
```{r}
#Group by branched papillae on long cells of interstomatal regions on abaxial surface only and obtain percentage present/absent
guadualeaf_river_per_ab_pap_int <- guadualeaf_river %>% 
  group_by(ab_branch_papillae_long_cells_interstomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_per_ab_pap)

#Create labeled pie chart of percentage of river specimens with branched papillae on long cells of interstomatal regions on abaxial surface
ggplot(guadualeaf_river_per_ab_pap_int, aes(x = "", y = perc, fill = ab_branch_papillae_long_cells_interstomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Branched papillae absent or present on long cells
                             of interstomatal region of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_abaxial_branched_papillae_interstomatal <- ggplot(guadualeaf_river_per_ab_pap_int, aes(x = "", y = perc, fill = ab_branch_papillae_long_cells_interstomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Branched papillae on long cells
  of interstomatal region of abaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_abaxial_branched_papillae_interstomatal.tiff", plot = river_pie_abaxial_branched_papillae_interstomatal, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of macrohairs on abaxial leaf surface presence/absence
```{r}
#Group by macrohairs on abaxial surface only and obtain percentage present/absent
guadualeaf_river_per_ab_macro <- guadualeaf_river %>% 
  group_by(ab_macro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_per_ab_macro)

#Create labeled pie chart of percentage of river specimens with papillae on long cells of interstomatal zones on abaxial surface
ggplot(guadualeaf_river_per_ab_macro, aes(x = "", y = perc, fill = ab_macro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs absent or present on
 abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_abaxial_macrohair <- ggplot(guadualeaf_river_per_ab_macro, aes(x = "", y = perc, fill = ab_macro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs on abaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_abaxial_macrohair.tiff", plot = river_pie_abaxial_macrohair, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of smooth saddle-shaped silica bodies in intercostal zones on abaxial leaf surface presence/absence
```{r}
#Group by smooth saddle-shaped silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_river_smooth_saddle_int_ab <- guadualeaf_river %>% 
  group_by(ab_smooth_saddle_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_smooth_saddle_int_ab)

#Create labeled pie chart of percentage of river specimens with smooth saddle-shaped silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_river_smooth_saddle_int_ab, aes(x = "", y = perc, fill = ab_smooth_saddle_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies absent or present in
                             of intercostal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_abaxial_smooth_saddle_int <- ggplot(guadualeaf_river_smooth_saddle_int_ab, aes(x = "", y = perc, fill = ab_smooth_saddle_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies in
  intercostal zone of abaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_abaxial_smooth_saddle_int.tiff", plot = river_pie_abaxial_smooth_saddle_int, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of nodular silica bodies in intercostal zones on abaxial leaf surface presence/absence
```{r}
#Group by nodular silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_river_nodular_int_ab <- guadualeaf_river %>% 
  group_by(ab_nodular_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_nodular_int_ab)

#Create labeled pie chart of percentage of river specimens with nodular silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_river_nodular_int_ab, aes(x = "", y = perc, fill = ab_nodular_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies absent or present in
                             of intercostal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_abaxial_nodular_int <- ggplot(guadualeaf_river_nodular_int_ab, aes(x = "", y = perc, fill = ab_nodular_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies in
  intercostal zone of abaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_abaxial_nodular_int.tiff", plot = river_pie_abaxial_nodular_int, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of bilobate silica bodies in costal zones on abaxial leaf surface presence/absence
```{r}
#Group by bilobate silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_river_bilobate_cost_ab <- guadualeaf_river %>% 
  group_by(ab_bilobate_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_bilobate_cost_ab)

#Create labeled pie chart of percentage of river specimens with bilobate silica bodies on long cells of costal zones on abaxial surface
ggplot(guadualeaf_river_bilobate_cost_ab, aes(x = "", y = perc, fill = ab_bilobate_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies absent or present in
            of costal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

river_pie_abaxial_bilobate_cost <- ggplot(guadualeaf_river_bilobate_cost_ab, aes(x = "", y = perc, fill = ab_bilobate_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies in
  costal zone of abaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_abaxial_bilobate_cost.tiff", plot = river_pie_abaxial_bilobate_cost, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of ridged saddle-shaped silica bodies in costal zones on abaxial leaf surface presence/absence
```{r}
#Group by ridged saddle-shaped silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_river_ridged_saddle_cost_ab <- guadualeaf_river %>% 
  group_by(ab_ridged_saddle_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_ridged_saddle_cost_ab)

#Create labeled pie chart of percentage of river specimens with ridged saddle-shaped silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_river_ridged_saddle_cost_ab, aes(x = "", y = perc, fill = ab_ridged_saddle_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies absent or present in
            of costal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_abaxial_ridged_saddle_cost <- ggplot(guadualeaf_river_ridged_saddle_cost_ab, aes(x = "", y = perc, fill = ab_ridged_saddle_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies in
  costal zone of abaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_abaxial_ridged_saddle_cost.tiff", plot = river_pie_abaxial_ridged_saddle_cost, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of simple papillae on long cells in stomatal region on adaxial leaf surface presence/absence
```{r}
#Group by simple papillae on long cells in stomatal region on adaxial surface only and obtain percentage present/absent
guadualeaf_river_simple_pap_stom_ad <- guadualeaf_river %>% 
  group_by(ad_simple_papillae_long_cells_stomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_ridged_saddle_cost_ab)

#Create labeled pie chart of percentage of river specimens with simple papillae on long cells in stomatal region on abaxial surface
ggplot(guadualeaf_river_simple_pap_stom_ad, aes(x = "", y = perc, fill = ad_simple_papillae_long_cells_stomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells absent or present
                    in stomatal region on abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_adaxial_papillae_simple_stomatal <- ggplot(guadualeaf_river_simple_pap_stom_ad, aes(x = "", y = perc, fill = ad_simple_papillae_long_cells_stomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells of 
  stomatal region on adaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_adaxial_simple_papillae_stomatal.tiff", plot = river_pie_adaxial_papillae_simple_stomatal, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of bicellular microhairs on adaxial leaf surface presence/absence
```{r}
#Group by bicellular microhairs on adaxial surface only and obtain percentage present/absent
guadualeaf_river_per_ad_bimicro <- guadualeaf_river %>% 
  group_by(ad_bimicro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_per_ad_bimicro)

#Create labeled pie chart of percentage of river specimens with macrohairs on adaxial surface
ggplot(guadualeaf_river_per_ad_bimicro, aes(x = "", y = perc, fill = ad_bimicro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bicellular microhairs absent or present on
 adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_adaxial_bimicro <- ggplot(guadualeaf_river_per_ad_bimicro, aes(x = "", y = perc, fill = ad_bimicro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bicellular microhairs on adaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_adaxial_bimicro.tiff", plot = river_pie_adaxial_bimicro, width = 6, height = 4, units = "in", dpi = 600)

```

##River: Pie chart of macrohairs on adaxial leaf surface presence/absence
```{r}
#Group by macrohairs on adaxial surface only and obtain percentage present/absent
guadualeaf_river_per_ad_macro <- guadualeaf_river %>% 
  group_by(ad_macro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_per_ad_macro)

#Create labeled pie chart of percentage of river specimens with macrohairs on adaxial surface
ggplot(guadualeaf_river_per_ad_macro, aes(x = "", y = perc, fill = ad_macro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs absent or present on
 adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_adaxial_macro <- ggplot(guadualeaf_river_per_ad_macro, aes(x = "", y = perc, fill = ad_macro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs on adaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_adaxial_macro.tiff", plot = river_pie_adaxial_macro, width = 6, height = 4, units = "in", dpi = 600)

```

##River: Pie chart of smooth saddle-shaped silica bodies in intercostal zones on adaxial leaf surface presence/absence
```{r}
#Group by smooth saddle-shaped silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_river_smooth_saddle_int_ad <- guadualeaf_river %>% 
  group_by(ad_smooth_saddle_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_smooth_saddle_int_ad)

#Create labeled pie chart of percentage of river specimens with smooth saddle-shaped silica bodies on long cells of intercostal zones on adaxial surface
ggplot(guadualeaf_river_smooth_saddle_int_ad, aes(x = "", y = perc, fill = ad_smooth_saddle_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies absent or present in
                             of intercostal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_adaxial_smooth_saddle_int <- ggplot(guadualeaf_river_smooth_saddle_int_ad, aes(x = "", y = perc, fill = ad_smooth_saddle_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies in 
  intercostal zone on adaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_adaxial_smooth_saddle_int.tiff", plot = river_pie_adaxial_smooth_saddle_int, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of nodular silica bodies in intercostal zones on adaxial leaf surface presence/absence
```{r}
#Group by nodular silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_river_nodular_int_ad <- guadualeaf_river %>% 
  group_by(ad_nodular_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_nodular_int_ad)

#Create labeled pie chart of percentage of river specimens with nodular silica bodies on long cells of intercostal zones on adaxial surface
ggplot(guadualeaf_river_nodular_int_ad, aes(x = "", y = perc, fill = ad_nodular_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies absent or present in
                             of intercostal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_adaxial_nodular_int <- ggplot(guadualeaf_river_nodular_int_ad, aes(x = "", y = perc, fill = ad_nodular_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies in 
  intercostal zone on adaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_adaxial_nodular_int.tiff", plot = river_pie_adaxial_nodular_int, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of bilobate silica bodies in costal zones on adaxial leaf surface presence/absence
```{r}
#Group by bilobate silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_river_bilobate_cost_ad <- guadualeaf_river %>% 
  group_by(ad_bilobate_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_bilobate_cost_ad)

#Create labeled pie chart of percentage of river specimens with bilobate silica bodies on long cells of costal zones on adaxial surface
ggplot(guadualeaf_river_bilobate_cost_ad, aes(x = "", y = perc, fill = ad_bilobate_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies absent or present in
            of costal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_adaxial_bilobate_cost <- ggplot(guadualeaf_river_bilobate_cost_ad, aes(x = "", y = perc, fill = ad_bilobate_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies in 
  costal zone on adaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_adaxial_bilobate_cost.tiff", plot = river_pie_adaxial_bilobate_cost, width = 6, height = 4, units = "in", dpi = 600)
```

##River: Pie chart of ridged saddle-shaped silica bodies in costal zones on adaxial leaf surface presence/absence
```{r}
#Group by ridged saddle-shaped silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_river_ridged_saddle_cost_ad <- guadualeaf_river %>% 
  group_by(ad_ridged_saddle_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_river_ridged_saddle_cost_ad)

#Create labeled pie chart of percentage of river specimens with ridged saddle-shaped silica bodies on long cells of costal zones on adaxial surface
ggplot(guadualeaf_river_ridged_saddle_cost_ad, aes(x = "", y = perc, fill = ad_ridged_saddle_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies absent or present in
            of costal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


river_pie_adaxial_ridged_saddle_cost <- ggplot(guadualeaf_river_ridged_saddle_cost_ad, aes(x = "", y = perc, fill = ad_ridged_saddle_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies in 
  costal zone on adaxial surface")) +
  ggtitle("River") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("river_pie_adaxial_ridged_saddle_cost.tiff", plot = river_pie_adaxial_ridged_saddle_cost, width = 6, height = 4, units = "in", dpi = 600)
```


## Pie charts - specimens from forest species

##Filtering dataframe for forest species only
```{r}
#Filter dataframe of foliar micromorphology to include only forest species
guadualeaf_forest <- df_guadualeaf %>%
  filter(habitat == "forest")
```

##Forest: Pie chart of simple papillae on long cells of stomatal regions on abaxial leaf surface presence/absence
```{r}
#Group by simple papillae on long cells of stomatal regions on abaxial surface only and obtain percentage present/absent
guadualeaf_forest_per_ab_pap_sto <- guadualeaf_forest %>% 
  group_by(ab_simple_papillae_long_cells_stomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_per_ab_pap_sto)

#Create labeled pie chart of percentage of forest specimens with papillae on long cells of stomatal regions on abaxial surface
ggplot(guadualeaf_forest_per_ab_pap_sto, aes(x = "", y = perc, fill = ab_simple_papillae_long_cells_stomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells
of stomatal region")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_abaxial_simple_papillae_stomatal <- ggplot(guadualeaf_forest_per_ab_pap_sto, aes(x = "", y = perc, fill = ab_simple_papillae_long_cells_stomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells
of stomatal region of abaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_abaxial_simple_papillae_stomatal.tiff", plot = forest_pie_abaxial_simple_papillae_stomatal, width = 6, height = 4, units = "in", dpi = 600)
```


##Forest: Pie chart of simple papillae on long cells of interstomatal regions of abaxial leaf surface presence/absence
```{r}
#Group by branched papillae on long cells of interstomatal regions on abaxial surface only and obtain percentage present/absent
guadualeaf_forest_per_ab_pap_int <- guadualeaf_forest %>% 
  group_by(ab_branch_papillae_long_cells_interstomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_per_ab_pap)

#Create labeled pie chart of percentage of forest specimens with branched papillae on long cells of interstomatal regions on abaxial surface
ggplot(guadualeaf_forest_per_ab_pap_int, aes(x = "", y = perc, fill = ab_branch_papillae_long_cells_interstomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Branched papillae absent or present on long cells
                             of interstomatal region of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_abaxial_branched_papillae_interstomatal <- ggplot(guadualeaf_forest_per_ab_pap_int, aes(x = "", y = perc, fill = ab_branch_papillae_long_cells_interstomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Branched papillae on long cells
  of interstomatal region of abaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_abaxial_branched_papillae_interstomatal.tiff", plot = forest_pie_abaxial_branched_papillae_interstomatal, width = 6, height = 4, units = "in", dpi = 600)
```


##Forest: Pie chart of macrohairs on abaxial leaf surface presence/absence
```{r}
#Group by macrohairs on abaxial surface only and obtain percentage present/absent
guadualeaf_forest_per_ab_macro <- guadualeaf_forest %>% 
  group_by(ab_macro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_per_ab_macro)

#Create labeled pie chart of percentage of forest specimens with papillae on long cells of interstomatal zones on abaxial surface
ggplot(guadualeaf_forest_per_ab_macro, aes(x = "", y = perc, fill = ab_macro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs absent or present on
 abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_abaxial_macrohair <- ggplot(guadualeaf_forest_per_ab_macro, aes(x = "", y = perc, fill = ab_macro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs on abaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_abaxial_macrohair.tiff", plot = forest_pie_abaxial_macrohair, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of smooth saddle-shaped silica bodies in intercostal zones on abaxial leaf surface presence/absence
```{r}
#Group by smooth saddle-shaped silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_forest_smooth_saddle_int_ab <- guadualeaf_forest %>% 
  group_by(ab_smooth_saddle_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_smooth_saddle_int_ab)

#Create labeled pie chart of percentage of forest specimens with smooth saddle-shaped silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_forest_smooth_saddle_int_ab, aes(x = "", y = perc, fill = ab_smooth_saddle_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies absent or present in
                             of intercostal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_abaxial_smooth_saddle_int <- ggplot(guadualeaf_forest_smooth_saddle_int_ab, aes(x = "", y = perc, fill = ab_smooth_saddle_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies in
  intercostal zone of abaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_abaxial_smooth_saddle_int.tiff", plot = forest_pie_abaxial_smooth_saddle_int, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of nodular silica bodies in intercostal zones on abaxial leaf surface presence/absence
```{r}
#Group by nodular silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_forest_nodular_int_ab <- guadualeaf_forest %>% 
  group_by(ab_nodular_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_nodular_int_ab)

#Create labeled pie chart of percentage of forest specimens with nodular silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_forest_nodular_int_ab, aes(x = "", y = perc, fill = ab_nodular_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies absent or present in
                             of intercostal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_abaxial_nodular_int <- ggplot(guadualeaf_forest_nodular_int_ab, aes(x = "", y = perc, fill = ab_nodular_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies in
  intercostal zone of abaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_abaxial_nodular_int.tiff", plot = forest_pie_abaxial_nodular_int, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of bilobate silica bodies in costal zones on abaxial leaf surface presence/absence
```{r}
#Group by bilobate silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_forest_bilobate_cost_ab <- guadualeaf_forest %>% 
  group_by(ab_bilobate_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_bilobate_cost_ab)

#Create labeled pie chart of percentage of forest specimens with bilobate silica bodies on long cells of costal zones on abaxial surface
ggplot(guadualeaf_forest_bilobate_cost_ab, aes(x = "", y = perc, fill = ab_bilobate_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies absent or present in
            of costal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

forest_pie_abaxial_bilobate_cost <- ggplot(guadualeaf_forest_bilobate_cost_ab, aes(x = "", y = perc, fill = ab_bilobate_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies in
  costal zone of abaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_abaxial_bilobate_cost.tiff", plot = forest_pie_abaxial_bilobate_cost, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of ridged saddle-shaped silica bodies in costal zones on abaxial leaf surface presence/absence
```{r}
#Group by ridged saddle-shaped silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_forest_ridged_saddle_cost_ab <- guadualeaf_forest %>% 
  group_by(ab_ridged_saddle_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_ridged_saddle_cost_ab)

#Create labeled pie chart of percentage of forest specimens with ridged saddle-shaped silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_forest_ridged_saddle_cost_ab, aes(x = "", y = perc, fill = ab_ridged_saddle_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies absent or present in
            of costal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_abaxial_ridged_saddle_cost <- ggplot(guadualeaf_forest_ridged_saddle_cost_ab, aes(x = "", y = perc, fill = ab_ridged_saddle_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies in
  costal zone of abaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_abaxial_ridged_saddle_cost.tiff", plot = forest_pie_abaxial_ridged_saddle_cost, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of simple papillae on long cells in stomatal region on adaxial leaf surface presence/absence
```{r}
#Group by simple papillae on long cells in stomatal region on adaxial surface only and obtain percentage present/absent
guadualeaf_forest_simple_pap_stom_ad <- guadualeaf_forest %>% 
  group_by(ad_simple_papillae_long_cells_stomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_ridged_saddle_cost_ab)

#Create labeled pie chart of percentage of forest specimens with simple papillae on long cells in stomatal region on abaxial surface
ggplot(guadualeaf_forest_simple_pap_stom_ad, aes(x = "", y = perc, fill = ad_simple_papillae_long_cells_stomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells absent or present
                    in stomatal region on abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_adaxial_papillae_simple_stomatal <- ggplot(guadualeaf_forest_simple_pap_stom_ad, aes(x = "", y = perc, fill = ad_simple_papillae_long_cells_stomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells of 
  stomatal region on adaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_adaxial_simple_papillae_stomatal.tiff", plot = forest_pie_adaxial_papillae_simple_stomatal, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of bicellular microhairs on adaxial leaf surface presence/absence
```{r}
#Group by bicellular microhairs on adaxial surface only and obtain percentage present/absent
guadualeaf_forest_per_ad_bimicro <- guadualeaf_forest %>% 
  group_by(ad_bimicro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_per_ad_bimicro)

#Create labeled pie chart of percentage of forest specimens with macrohairs on adaxial surface
ggplot(guadualeaf_forest_per_ad_bimicro, aes(x = "", y = perc, fill = ad_bimicro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bicellular microhairs absent or present on
 adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_adaxial_bimicro <- ggplot(guadualeaf_forest_per_ad_bimicro, aes(x = "", y = perc, fill = ad_bimicro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bicellular microhairs on adaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_adaxial_bimicro.tiff", plot = forest_pie_adaxial_bimicro, width = 6, height = 4, units = "in", dpi = 600)

```

##Forest: Pie chart of macrohairs on adaxial leaf surface presence/absence
```{r}
#Group by macrohairs on adaxial surface only and obtain percentage present/absent
guadualeaf_forest_per_ad_macro <- guadualeaf_forest %>% 
  group_by(ad_macro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_per_ad_macro)

#Create labeled pie chart of percentage of forest specimens with macrohairs on adaxial surface
ggplot(guadualeaf_forest_per_ad_macro, aes(x = "", y = perc, fill = ad_macro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs absent or present on
 adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_adaxial_macro <- ggplot(guadualeaf_forest_per_ad_macro, aes(x = "", y = perc, fill = ad_macro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs on adaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_adaxial_macro.tiff", plot = forest_pie_adaxial_macro, width = 6, height = 4, units = "in", dpi = 600)

```

##Forest: Pie chart of smooth saddle-shaped silica bodies in intercostal zones on adaxial leaf surface presence/absence
```{r}
#Group by smooth saddle-shaped silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_forest_smooth_saddle_int_ad <- guadualeaf_forest %>% 
  group_by(ad_smooth_saddle_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_smooth_saddle_int_ad)

#Create labeled pie chart of percentage of forest specimens with smooth saddle-shaped silica bodies on long cells of intercostal zones on adaxial surface
ggplot(guadualeaf_forest_smooth_saddle_int_ad, aes(x = "", y = perc, fill = ad_smooth_saddle_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies absent or present in
                             of intercostal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_adaxial_smooth_saddle_int <- ggplot(guadualeaf_forest_smooth_saddle_int_ad, aes(x = "", y = perc, fill = ad_smooth_saddle_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies in 
  intercostal zone on adaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_adaxial_smooth_saddle_int.tiff", plot = forest_pie_adaxial_smooth_saddle_int, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of nodular silica bodies in intercostal zones on adaxial leaf surface presence/absence
```{r}
#Group by nodular silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_forest_nodular_int_ad <- guadualeaf_forest %>% 
  group_by(ad_nodular_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_nodular_int_ad)

#Create labeled pie chart of percentage of forest specimens with nodular silica bodies on long cells of intercostal zones on adaxial surface
ggplot(guadualeaf_forest_nodular_int_ad, aes(x = "", y = perc, fill = ad_nodular_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies absent or present in
                             of intercostal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_adaxial_nodular_int <- ggplot(guadualeaf_forest_nodular_int_ad, aes(x = "", y = perc, fill = ad_nodular_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies in 
  intercostal zone on adaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_adaxial_nodular_int.tiff", plot = forest_pie_adaxial_nodular_int, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of bilobate silica bodies in costal zones on adaxial leaf surface presence/absence
```{r}
#Group by bilobate silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_forest_bilobate_cost_ad <- guadualeaf_forest %>% 
  group_by(ad_bilobate_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_bilobate_cost_ad)

#Create labeled pie chart of percentage of forest specimens with bilobate silica bodies on long cells of costal zones on adaxial surface
ggplot(guadualeaf_forest_bilobate_cost_ad, aes(x = "", y = perc, fill = ad_bilobate_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies absent or present in
            of costal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_adaxial_bilobate_cost <- ggplot(guadualeaf_forest_bilobate_cost_ad, aes(x = "", y = perc, fill = ad_bilobate_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies in 
  costal zone on adaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_adaxial_bilobate_cost.tiff", plot = forest_pie_adaxial_bilobate_cost, width = 6, height = 4, units = "in", dpi = 600)
```

##Forest: Pie chart of ridged saddle-shaped silica bodies in costal zones on adaxial leaf surface presence/absence
```{r}
#Group by ridged saddle-shaped silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_forest_ridged_saddle_cost_ad <- guadualeaf_forest %>% 
  group_by(ad_ridged_saddle_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_forest_ridged_saddle_cost_ad)

#Create labeled pie chart of percentage of forest specimens with ridged saddle-shaped silica bodies on long cells of costal zones on adaxial surface
ggplot(guadualeaf_forest_ridged_saddle_cost_ad, aes(x = "", y = perc, fill = ad_ridged_saddle_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies absent or present in
            of costal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


forest_pie_adaxial_ridged_saddle_cost <- ggplot(guadualeaf_forest_ridged_saddle_cost_ad, aes(x = "", y = perc, fill = ad_ridged_saddle_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies in 
  costal zone on adaxial surface")) +
  ggtitle("Forest") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("forest_pie_adaxial_ridged_saddle_cost.tiff", plot = forest_pie_adaxial_ridged_saddle_cost, width = 6, height = 4, units = "in", dpi = 600)
```


###Pie charts - specimens from savanna species

##Filtering dataframe for savanna species only
```{r}
#Filter dataframe of foliar micromorphology to include only savanna species
guadualeaf_savanna <- df_guadualeaf %>%
  filter(general_habitat == "savanna")

```

##Savanna: Pie chart of simple papillae on long cells of stomatal regions on abaxial leaf surface presence/absence
```{r}
#Group by simple papillae on long cells of stomatal regions on abaxial surface only and obtain percentage present/absent
guadualeaf_savanna_per_ab_pap <- guadualeaf_savanna %>% 
  group_by(ab_simple_papillae_long_cells_stomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_per_ab_pap)

#Create labeled pie chart of percentage of savanna specimens with papillae on long cells of stomatal regions on abaxial surface
ggplot(guadualeaf_savanna_per_ab_pap, aes(x = "", y = perc, fill = ab_simple_papillae_long_cells_stomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on
long cells of stomatal regions")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("present", "absent"), values = c("#f7b54a", "#71caeb")) +
  theme_void()


savanna_pie_abaxial_simple_papillae_stomatal <- ggplot(guadualeaf_savanna_per_ab_pap, aes(x = "", y = perc, fill = ab_simple_papillae_long_cells_stomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on
long cells of stomatal regions")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("present", "absent"), values = c("#f7b54a", "#71caeb")) +
  theme_void()

ggsave("savanna_pie_abaxial_simple_papillae_stomatal.tiff", plot = savanna_pie_abaxial_simple_papillae_stomatal, width = 6, height = 4, units = "in", dpi = 600)

```

##Savanna: Pie chart of branched papillae on long cells of interstomatal zones on abaxial leaf surface presence/absence
```{r}
#Group by simple papillae on long cells of interstomatal regions on abaxial surface only and obtain percentage present/absent
guadualeaf_savanna_per_ab_pap_int <- guadualeaf_savanna %>% 
  group_by(ab_branch_papillae_long_cells_interstomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_per_ab_pap_int)

#Create labeled pie chart of percentage of savanna specimens with papillae on long cells of interstomatal regions on abaxial surface
ggplot(guadualeaf_savanna_per_ab_pap_int, aes(x = "", y = perc, fill = ab_branch_papillae_long_cells_interstomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae absent or present on
  long cells of interstomatal regions")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


savanna_pie_abaxial_branch_papillae_interstomatal <- ggplot(guadualeaf_savanna_per_ab_pap_int, aes(x = "", y = perc, fill = ab_branch_papillae_long_cells_interstomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Branched papillae in interstomatal region
  of abaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_abaxial_branched_papillae_interstomatal.tiff", plot = savanna_pie_abaxial_branch_papillae_interstomatal, width = 6, height = 4, units = "in", dpi = 600)
```


##Savanna: Pie chart of macrohairs on abaxial leaf surface presence/absence
```{r}
#Group by macrohairs on abaxial surface only and obtain percentage present/absent
guadualeaf_savanna_ab_macro <- guadualeaf_savanna %>% 
  group_by(ab_macro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_ab_macro)

#Create labeled pie chart of percentage of general forest specimens with papillae on long cells of stomatal zones on abaxial surface
ggplot(guadualeaf_savanna_ab_macro, aes(x = "", y = perc, fill = ab_macro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs absent or present on
abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


savanna_pie_abaxial_macrohair <- ggplot(guadualeaf_savanna_ab_macro, aes(x = "", y = perc, fill = ab_macro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs on abaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_abaxial_macrohair.tiff", plot = savanna_pie_abaxial_macrohair, width = 6, height = 4, units = "in", dpi = 600)
```


##Savanna: Pie chart of smooth saddle-shaped silica bodies in intercostal zones on abaxial leaf surface presence/absence
```{r}
#Group by smooth saddle-shaped silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_savanna_smooth_saddle_int_ab <- guadualeaf_savanna %>% 
  group_by(ab_smooth_saddle_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_smooth_saddle_int_ab)

#Create labeled pie chart of percentage of general forest specimens with branched papillae on long cells of intercostal zones on abaxial surface
 ggplot(guadualeaf_savanna_smooth_saddle_int_ab, aes(x = "", y = perc, fill = ab_smooth_saddle_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies absent or present in
                             of intercostal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

savanna_pie_abaxial_smooth_saddle_int <- ggplot(guadualeaf_savanna_smooth_saddle_int_ab, aes(x = "", y = perc, fill = ab_smooth_saddle_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies in 
  intercostal zone on abaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_abaxial_smooth_saddle_int.tiff", plot = savanna_pie_abaxial_smooth_saddle_int, width = 6, height = 4, units = "in", dpi = 600)
```

##Savanna: Pie chart of nodular silica bodies in intercostal zones on abaxial leaf surface presence/absence
```{r}
#Group by nodular silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_savanna_nodular_int_ab <- guadualeaf_savanna %>% 
  group_by(ab_nodular_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_nodular_int_ab)

#Create labeled pie chart of percentage of general forest specimens with nodular silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_savanna_nodular_int_ab, aes(x = "", y = perc, fill = ab_nodular_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies absent or present in
  of intercostal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

savanna_pie_abaxial_nodular_int <- ggplot(guadualeaf_savanna_nodular_int_ab, aes(x = "", y = perc, fill = ab_nodular_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies in 
  intercostal zone on abaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_abaxial_nodular_int.tiff", plot = savanna_pie_abaxial_nodular_int, width = 6, height = 4, units = "in", dpi = 600)
```

##Savanna: Pie chart of bilobate silica bodies in costal zones on abaxial leaf surface presence/absence
```{r}
#Group by nodular silica bodes in intercostal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_savanna_bilobate_cost_ab <- guadualeaf_savanna %>% 
  group_by(ab_bilobate_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_bilobate_cost_ab)

#Create labeled pie chart of percentage of general forest specimens with bilobate silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_savanna_bilobate_cost_ab, aes(x = "", y = perc, fill = ab_bilobate_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies absent or present in
            of costal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

savanna_pie_abaxial_bilobate_cost <- ggplot(guadualeaf_savanna_bilobate_cost_ab, aes(x = "", y = perc, fill = ab_bilobate_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies in 
  costal zone on abaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_abaxial_bilobate_cost.tiff", plot = savanna_pie_abaxial_bilobate_cost, width = 6, height = 4, units = "in", dpi = 600)
```

##Savanna: Pie chart of ridged saddle-shaped silica bodies in costal zones on abaxial leaf surface presence/absence
```{r}
#Group by ridged saddle-shaped silica bodies in costal zones on abaxial surface only and obtain percentage present/absent
guadualeaf_savanna_ridged_saddle_cost_ab <- guadualeaf_savanna %>% 
  group_by(ab_ridged_saddle_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_ridged_saddle_cost_ab)

#Create labeled pie chart of percentage of savanna specimens with ridged saddle-shaped silica bodies on long cells of costal zones on abaxial surface
ggplot(guadualeaf_savanna_ridged_saddle_cost_ab, aes(x = "", y = perc, fill = ab_ridged_saddle_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies absent or present in
            of costal zone of abaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

savanna_pie_abaxial_ridged_saddle_cost <- ggplot(guadualeaf_savanna_ridged_saddle_cost_ab, aes(x = "", y = perc, fill = ab_ridged_saddle_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies in 
  costal zone on abaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_abaxial_ridged_saddle_cost.tiff", plot = savanna_pie_abaxial_ridged_saddle_cost, width = 6, height = 4, units = "in", dpi = 600)
```

##Savanna: Pie chart of simple papillae on long cells in stomatal region on adaxial leaf surface presence/absence
```{r}
#Group by simple papillae on long cells in stomatal region on adaxial surface only and obtain percentage present/absent
guadualeaf_savanna_simple_pap_stom_ad <- guadualeaf_savanna %>% 
  group_by(ad_simple_papillae_long_cells_stomatal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_simple_pap_stom_ad)

#Create labeled pie chart of percentage of savanna specimens with simple papillae on long cells in stomatal region on abaxial surface
ggplot(guadualeaf_savanna_simple_pap_stom_ad, aes(x = "", y = perc, fill = ad_simple_papillae_long_cells_stomatal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on long cells of absent or present
                    in stomatal region on abaxial surface")) +
  scale_fill_manual(labels = c("present", "absent"), values = c("#f7b54a", "#71caeb")) +
  theme_void()


savanna_pie_adaxial_simple_papillae_stomatal <- ggplot(guadualeaf_savanna_simple_pap_stom_ad, aes(x = "", y = perc, fill = ad_simple_papillae_long_cells_stomatal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Simple papillae on
long cells of stomatal regions on adaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("present", "absent"), values = c("#f7b54a", "#71caeb")) +
  theme_void()

ggsave("savanna_pie_adaxial_simple_papillae_stomatal.tiff", plot = savanna_pie_adaxial_simple_papillae_stomatal, width = 6, height = 4, units = "in", dpi = 600)
```

##Savanna: Pie chart of bicellular microhairs on adaxial leaf surface presence/absence
```{r}
#Group by bicellular microhairs on adaxial surface only and obtain percentage present/absent
guadualeaf_savanna_per_ad_bimicro <- guadualeaf_savanna %>% 
  group_by(ad_bimicro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_per_ad_bimicro)

#Create labeled pie chart of percentage of savanna specimens with macrohairs on adaxial surface
ggplot(guadualeaf_savanna_per_ad_bimicro, aes(x = "", y = perc, fill = ad_bimicro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bicellular microhairs absent or present on
 adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()



savanna_pie_adaxial_bimicro <- ggplot(guadualeaf_savanna_per_ad_bimicro, aes(x = "", y = perc, fill = ad_bimicro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bicellular microhairs on adaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_adaxial_bimicro.tiff", plot = savanna_pie_adaxial_bimicro, width = 6, height = 4, units = "in", dpi = 600)

```

##Savanna: Pie chart of macrohairs on adaxial leaf surface presence/absence
```{r}
#Group by macrohairs on adaxial surface only and obtain percentage present/absent
guadualeaf_savanna_per_ad_macro <- guadualeaf_savanna %>% 
  group_by(ad_macro) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_per_ad_macro)

#Create labeled pie chart of percentage of savanna specimens with macrohairs on adaxial surface
ggplot(guadualeaf_savanna_per_ad_macro, aes(x = "", y = perc, fill = ad_macro)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs absent or present on
 adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


savanna_pie_adaxial_macro <- ggplot(guadualeaf_savanna_per_ad_macro, aes(x = "", y = perc, fill = ad_macro)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Macrohairs on adaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_adaxial_macro.tiff", plot = savanna_pie_adaxial_macro, width = 6, height = 4, units = "in", dpi = 600)

```

##Savanna: Pie chart of smooth saddle-shaped silica bodies in intercostal zones on adaxial leaf surface presence/absence
```{r}
#Group by smooth saddle-shaped silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_savanna_smooth_saddle_int_ad <- guadualeaf_savanna %>% 
  group_by(ad_smooth_saddle_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_smooth_saddle_int_ad)

#Create labeled pie chart of percentage of savanna specimens with smooth saddle-shaped silica bodies on long cells of intercostal zones on adaxial surface
ggplot(guadualeaf_savanna_smooth_saddle_int_ad, aes(x = "", y = perc, fill = ad_smooth_saddle_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies absent or present in
                             of intercostal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


savanna_pie_adaxial_smooth_saddle_int <- ggplot(guadualeaf_savanna_smooth_saddle_int_ad, aes(x = "", y = perc, fill = ad_smooth_saddle_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Smooth saddle-shaped silica bodies in 
  intercostal zone on adaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_adaxial_smooth_saddle_int.tiff", plot = savanna_pie_adaxial_smooth_saddle_int, width = 6, height = 4, units = "in", dpi = 600)
```

##Savanna: Pie chart of nodular silica bodies in intercostal zones on adaxial leaf surface presence/absence
```{r}
#Group by nodular silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_savanna_nodular_int_ad <- guadualeaf_savanna %>% 
  group_by(ad_nodular_intercostal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_nodular_int_ad)

#Create labeled pie chart of percentage of savanna specimens with nodular silica bodies on long cells of intercostal zones on adaxial surface
ggplot(guadualeaf_savanna_nodular_int_ad, aes(x = "", y = perc, fill = ad_nodular_intercostal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies absent or present in
                             of intercostal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


savanna_pie_adaxial_nodular_int <- ggplot(guadualeaf_savanna_nodular_int_ad, aes(x = "", y = perc, fill = ad_nodular_intercostal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Nodular silica bodies in 
  intercostal zone on adaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_adaxial_nodular_int.tiff", plot = savanna_pie_adaxial_nodular_int, width = 6, height = 4, units = "in", dpi = 600)
```

##Savanna: Pie chart of bilobate silica bodies in costal zones on adaxial leaf surface presence/absence
```{r}
#Group by bilobate silica bodes in intercostal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_savanna_bilobate_cost_ad <- guadualeaf_savanna %>% 
  group_by(ad_bilobate_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_bilobate_cost_ad)

#Create labeled pie chart of percentage of savanna specimens with bilobate silica bodies on long cells of intercostal zones on abaxial surface
ggplot(guadualeaf_savanna_bilobate_cost_ad, aes(x = "", y = perc, fill = ad_bilobate_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies absent or present in
            of costal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


savanna_pie_adaxial_bilobate_cost <- ggplot(guadualeaf_savanna_bilobate_cost_ad, aes(x = "", y = perc, fill = ad_bilobate_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Bilobate silica bodies in 
  costal zone on adaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_adaxial_bilobate_cost.tiff", plot = savanna_pie_adaxial_bilobate_cost, width = 6, height = 4, units = "in", dpi = 600)
```


##Savanna: Pie chart of ridged saddle-shaped silica bodies in costal zones on adaxial leaf surface presence/absence
```{r}
#Group by savanna saddle-shaped silica bodes in costal zones on adaxial surface only and obtain percentage present/absent
guadualeaf_savanna_ridged_saddle_cost_ad <- guadualeaf_savanna %>% 
  group_by(ad_ridged_saddle_costal) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

#view(guadualeaf_savanna_ridged_saddle_cost_ad)

#Create labeled pie chart of percentage of savanna specimens with ridged saddle-shaped silica bodies on long cells of costal zones on adaxial surface
ggplot(guadualeaf_savanna_ridged_saddle_cost_ad, aes(x = "", y = perc, fill = ad_ridged_saddle_costal)) +
  geom_col(color = "black") +
  geom_label(aes(label = labels),
             position = position_stack(vjust = 0.5),
             show.legend = FALSE) +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies absent or present in
            of costal zone of adaxial surface")) +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()


savanna_pie_adaxial_ridged_saddle_cost <- ggplot(guadualeaf_savanna_ridged_saddle_cost_ad, aes(x = "", y = perc, fill = ad_ridged_saddle_costal)) +
  geom_col() +
  coord_polar(theta = "y") +
  guides(fill = guide_legend(title = "Ridged saddle-shaped silica bodies in 
  costal zone on adaxial surface")) +
  ggtitle("Savanna") +
  scale_fill_manual(labels = c("absent", "present"), values = c("#71caeb", "#f7b54a")) +
  theme_void()

ggsave("savanna_pie_adaxial_ridged_saddle_cost.tiff", plot = savanna_pie_adaxial_ridged_saddle_cost, width = 6, height = 4, units = "in", dpi = 600)
```
